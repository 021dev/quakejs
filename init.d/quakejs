#!/bin/sh
#
# /etc/init.d/quakejs
# Subsystem file for "quakejs" server
#
# chkconfig: 2345 95 05
# description: QuakeJS server daemon
#
# processname: quakejs
# pidfile: /var/run/quakejs.pid
#
# script assumes QuakeJS is installed/cloned
# to '/home/quake/quakejs' and that the user
# 'quake' will run the game server. Change
# line 19 to adjust this

RETVAL=0
prog="quakejs"

start() {
	echo "Starting $prog:"
	daemonize -v -p /var/run/$prog.pid -c /home/quake/quakejs -u quake /usr/bin/node build/ioq3ded.js +set fs_game baseq3 set dedicated 1 +exec server.cfg
	RETVAL=$?
	[ "$RETVAL" = 0 ] && touch /var/lock/subsys/$prog
	echo
}

stop() {
	echo "Stopping $prog:"
	killproc $prog -TERM
	RETVAL=$?
	[ "$RETVAL" = 0 ] && rm -f /var/lock/subsys/$prog
	echo
}

case "$1" in
	start)
		start
		;;
	stop)
		stop
		;;
	restart)
		stop
		sleep 3
		start
		;;
	condrestart)
		if [ -f /var/lock/subsys/$prog ] ; then
			stop
			# avoid race
			sleep 3
			start
		fi
		;;
	status)
		status $prog
		RETVAL=$?
		;;
	*)
		echo $"Usage: $0 {start|stop|restart|condrestart|status}"
		RETVAL=1
esac
exit $RETVAL
